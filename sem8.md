# Семинар 8 (29 сентября 2017)

Обсуждали, зачем нужен explicit в конструкторах, как использовать static-переменные в классах и как компилировать программы из нескольких файлов.

### explicit и static-члены классов

Посмотрим на пример с семинара. Напишем класс Person, который будет хранить имя человека
и подсчитывать количество людей, которые сейчас созданы.
```cpp
struct Person {
    string name;

    // эта переменная -- одна на все экземпляры класса. По факту -- глобальная
    static int counter;

    // обратите внимание на explicit. Дальше будет пояснение, зачем это нужно
    explicit Person(string name) :
        name(std::move(name))
    {
        ++counter; // увеличиваем счётчик при создании нового человека
    }

    ~Person() {
        --counter; // уменьшаем счётчик при удалении человека
    }

    Person(const Person& other) :
        name(other.name)
    {
        ++counter; // также увеличиваем счётчик при копировании...
    }

    Person& operator=(const Person& other) {
        name = other.name;
        ++counter; // и при копировании через присваивание
        return *this;
    }
};

// Когда мы написали 'static int counter' в теле класса, мы только объявили переменную,
// при этом не указав ей физического места для жизни. Это нужно для того, чтобы мы могли
// подключить класс в нескольких cpp-файлах: иначе бы в каждом из них компилятор выделил
// память под эту переменную, и было бы непонятно, какую из областей нужно использовать.
//
// Поэтому в одном из сpp-файлов нужно явно указать, что место под переменную должно
// быть выделено именно сейчас. Заодно можно присвоить исходное значение.
int Person::counter = 0;

void print(const Person& person) {
    cout << "Hello, I'm " << person.name << ", and there are "
        << person.counter << " people in the world" << endl;
}

int main() {
    string s = "q";
    print(s); // не компилируется: конструктор Person(string) объявлен explicit
    print(Person(s)); // компилируется
}
```

explicit (переводится как *явный*) нужен для того, чтобы мы не могли неявно вызвать конструктор
класса. Так, в строчке `print(s)` происходит именно это: мы пытаемся вызвать функцию
`print(Person)`, но передаём строку. Если бы конструктор не был explicit, объект Person
бы неявно создался от строки и передался в функцию.

Иногда такое неявное преобразование может приводить к ошибкам, поэтому если вы хотите, чтобы
пользователь вашего класса не мог создавать объекты неявно, используйте explicit.

Хорошим тоном считается писать explicit у всех конструкторов от одной переменной,
кроме случаев, когда вам явно нужна возможность неявного создания. В таких случаях
рекомендуется написать рядом комментарий: `// implicit`.

### Компиляция программ из нескольких файлов
To be continued...
